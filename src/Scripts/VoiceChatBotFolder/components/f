import  { useState } from 'react';
import { Mic,Send  } from 'lucide-react';

const Chat = () => {
    const [messages, setMessages] = useState([]);
    const [listening, setListening] = useState(false);

    const handleVoiceInput = () => {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.start();

        recognition.onstart = () => setListening(true);
        recognition.onend = () => setListening(false);

        recognition.onresult = (event) => {
            const userMessage = event.results[0][0].transcript;
            setMessages([...messages, { text: userMessage, from: 'user' }]);
            
            fetch('http://localhost:5000/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: userMessage }),
            })
            .then(response => response.json())
            .then(botMessage => {
                setMessages([...messages, { text: userMessage, from: 'user' }, { text: botMessage, from: 'bot' }]);
                
                // Speak the bot's response
                const utterance = new SpeechSynthesisUtterance(botMessage);
                window.speechSynthesis.speak(utterance);
            })
            .catch(error => console.error('Error:', error));
        };
    };

    return (
        <div className="relative mt-4 mr-3 border h-full w-full    pl-4 pt-4 pb-4 border-gray-300 rounded-lg bg-white bg-opacity-80 shadow-md backdrop-blur-md z-10">
            <div className="absolute inset-x-0 bottom-0  bg-purple-100 rounded-xl  h-12 mb-4 mr-4 ml-4 ">
              <div className="flex justify-row items-center h-full">
                <button  onClick={handleVoiceInput}>
                    <div className="flex items-center justify-center h-8 w-8 rounded-full bg-twilight-300 text-white ml-2">
                     {
                        listening ? 
                        <div className="animate-pulse"><Mic size={24} /></div> :
                        <Mic size={24} />
                     }
                    </div>
                </button>

                <input 
                        type="text" 
                        className="h-10 w-full ml-2 rounded-xl bg-purple-50 text-base text-twilight-300 px-2  border-2 border-gray-100 focus:outline-none focus:border-twilight-300 focus:border-2" 
                        placeholder="Type a message..." 
                />

                <button className="flex items-center justify-center h-8 w-24 rounded-full bg-twilight-300 text-white mr-2 ml-2 ">
                    <Send size={24} className="" />
                    <p className="ml-2">Send</p>
                </button>
                </div>

            </div>
               
            
        </div>
    );
};

export default Chat;